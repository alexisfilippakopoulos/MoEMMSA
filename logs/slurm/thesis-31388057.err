/leonardo_work/EUHPC_A04_051/alexfil/MoEMMSA/experiments/regression/../../MMSA/utils/schedulers.py:108: SyntaxWarning: "is not" with a literal. Did you mean "!="?
  params_decay = [p for n, p in model.named_parameters() if n is not 'bias']
/leonardo_work/EUHPC_A04_051/alexfil/MoEMMSA/experiments/regression/../../MMSA/utils/schedulers.py:109: SyntaxWarning: "is" with a literal. Did you mean "=="?
  params_no_decay = [p for n, p in model.named_parameters() if n is 'bias']
MMSA - ======================================== Program Start ========================================
MMSA - Running with args:
MMSA - {'model_name': 'msalm', 'dataset_name': 'sims', 'featurePath': '/leonardo_work/EUHPC_A04_051/alexfil/MSA-Datasets/CH-SIMS/unaligned_39.pkl', 'seq_lens': [39, 400, 55], 'feature_dims': [768, 33, 709], 'train_samples': 1368, 'num_classes': 3, 'language': 'cn', 'KeyEval': 'Loss', 'missing_rate': [0.0, 0.0, 0.0], 'missing_seed': [1111, 1111, 1111], 'need_data_aligned': False, 'need_model_aligned': False, 'early_stop': 10, 'use_bert': False, 'use_bert_finetune': False, 'attn_mask': True, 'excludeZero': True, 'update_epochs': 8, 'use_augmentation': False, 'use_m3xup': False, 'hfPath': False, 'use_ulgm': False, 'update_labels_patience': 1, 'H': 3.0, 'del_model': True, 'max_token_len': 39, 'pad_token': '<|endoftext|>', 'lm': '/leonardo_work/EUHPC_A04_051/alexfil/gpt2-chinese-cluecorpussmall', 'use_bf16': False, 'task_out': 1, 'use_clm': True, 'gamma': 1.0, 'l_bn': 1.0, 'l_av': 1.0, 'l_t': 1.0, 'warmup_epochs': 1, 'max_epochs': 100, 'beta_1': 0.9, 'beta_2': 0.95, 'use_lnorm': True, 'rescale': False, 'rescaler': 'sqrt', 'use_seqaug': True, 'n_bn_fusion': 16, 'modded_loss': True, 'embedding_attr_name': 'transformer.wte', 'decoder_layers_attr_name': 'transformer.h', 'mmgpt': {'type': 'gpt2', 'd_out': 64, 'combine': True, 'dropout': 0.1, 'mm_layer': [5, 6, 7, 8, 9, 10, 11], 'top_k': 2, 'layer_dropout': 0.0, 'dense': True, 'tie_ffn': True, 'n_embd': 768, 'bias': True, 'kv_dim': 30, 'n_head': 16, 'd_mm': 768, 'gating': 'sigmoid', 'init_gate': [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], 'use_softperm': True, 'p_perm': 0.3, 'p_apply': 0.25, 'use_lora': False, 'lora': {'lora_alpha': 128, 'r': 64, 'lora_dropout': 0.05}}, 'av_enc': {'finetune': True, 'from_pretrained': True, 'path_to_pretrained': '/leonardo_work/EUHPC_A04_051/alexfil/DeepMLF-Reprod/checkpoints/bienc-sims-1990/bienc-sims-1990.pth', 'feature_dims': [768, 33, 709], 'd_enc': 30, 'n_embd': 30, 'n_head': 6, 'nlevels': 3, 'd_enc_out': 30, 'maxlen': 55, 'p_mask': 0.15, 'enc_attn_dropout': 0.1, 'enc_res_dropout': 0.1, 'enc_dropout': 0.1, 'use_softperm': True, 'p_perm': 0.2, 'mask_perm_ratio': 0.5, 'tf_fusion': False, 'use_bn': True, 'use_ln': False}, 'gpt': {'vocab_size': 50257, 'block_size': 1024, 'bias': True, 'n_embd': 1024, 'n_layer': 24, 'n_head': 16, 'dropout': 0.0}, 'batch_size': 32, 'grad_clip': 5.0, 'patience': 10, 'weight_decay_mmgpt': 0.1, 'weight_decay_av': 0.1, 'learning_rate_av': 0.0001, 'learning_rate_mmgpt': 0.0001, 'device': device(type='cuda', index=0), 'train_mode': 'regression', 'custom_feature': None, 'feature_T': '', 'feature_A': '', 'feature_V': ''}
MMSA - Seeds: [1990, 1991, 1992, 1993, 1994]
MMSA - ------------------------------ Running with seed 1990 [1/5] ------------------------------
Map:   0%|          | 0/1368 [00:00<?, ? examples/s]Map:  24%|██▎       | 323/1368 [00:00<00:00, 3182.93 examples/s]Map:  52%|█████▏    | 708/1368 [00:00<00:00, 3569.40 examples/s]Map:  87%|████████▋ | 1194/1368 [00:01<00:00, 928.71 examples/s]                                                                Map (num_proc=8):   0%|          | 0/1368 [00:00<?, ? examples/s]Map (num_proc=8):  12%|█▎        | 171/1368 [00:05<00:39, 30.10 examples/s]Map (num_proc=8):  25%|██▌       | 342/1368 [00:07<00:19, 52.77 examples/s]Map (num_proc=8):  38%|███▊      | 513/1368 [00:08<00:11, 73.48 examples/s]Map (num_proc=8):  50%|█████     | 684/1368 [00:10<00:08, 83.36 examples/s]Map (num_proc=8):  62%|██████▎   | 855/1368 [00:11<00:05, 89.38 examples/s]Map (num_proc=8):  75%|███████▌  | 1026/1368 [00:12<00:03, 105.80 examples/s]Map (num_proc=8): 100%|██████████| 1368/1368 [00:13<00:00, 164.53 examples/s]                                                                             Map:   0%|          | 0/1368 [00:00<?, ? examples/s]Map:   2%|▏         | 32/1368 [00:00<00:04, 304.91 examples/s]Map:   5%|▍         | 64/1368 [00:00<00:04, 303.56 examples/s]Map:   7%|▋         | 96/1368 [00:00<00:04, 304.22 examples/s]Map:   9%|▉         | 128/1368 [00:00<00:04, 303.27 examples/s]Map:  12%|█▏        | 160/1368 [00:00<00:03, 302.61 examples/s]Map:  14%|█▍        | 192/1368 [00:00<00:03, 303.21 examples/s]Map:  16%|█▋        | 224/1368 [00:00<00:03, 303.02 examples/s]Map:  19%|█▊        | 256/1368 [00:00<00:03, 302.39 examples/s]Map:  21%|██        | 288/1368 [00:00<00:03, 302.00 examples/s]Map:  23%|██▎       | 320/1368 [00:01<00:03, 301.57 examples/s]Map:  26%|██▌       | 352/1368 [00:01<00:03, 301.49 examples/s]Map:  28%|██▊       | 384/1368 [00:01<00:03, 301.35 examples/s]Map:  30%|███       | 415/1368 [00:01<00:03, 300.91 examples/s]Map:  33%|███▎      | 447/1368 [00:01<00:03, 301.08 examples/s]Map:  35%|███▍      | 478/1368 [00:01<00:02, 300.94 examples/s]Map:  37%|███▋      | 509/1368 [00:01<00:02, 300.59 examples/s]Map:  40%|███▉      | 541/1368 [00:01<00:02, 301.21 examples/s]Map:  42%|████▏     | 573/1368 [00:01<00:02, 301.07 examples/s]Map:  44%|████▍     | 605/1368 [00:02<00:02, 300.76 examples/s]Map:  46%|████▋     | 636/1368 [00:02<00:02, 300.40 examples/s]Map:  50%|████▉     | 681/1368 [00:02<00:02, 299.41 examples/s]Map:  52%|█████▏    | 712/1368 [00:02<00:02, 299.37 examples/s]Map:  54%|█████▍    | 742/1368 [00:02<00:02, 298.88 examples/s]Map:  56%|█████▋    | 772/1368 [00:02<00:01, 298.77 examples/s]Map:  59%|█████▊    | 802/1368 [00:02<00:01, 298.39 examples/s]Map:  61%|██████    | 832/1368 [00:02<00:01, 298.20 examples/s]Map:  63%|██████▎   | 863/1368 [00:02<00:01, 298.95 examples/s]Map:  65%|██████▌   | 893/1368 [00:02<00:01, 298.88 examples/s]Map:  67%|██████▋   | 923/1368 [00:03<00:01, 298.99 examples/s]Map:  70%|██████▉   | 953/1368 [00:03<00:01, 298.89 examples/s]Map:  72%|███████▏  | 983/1368 [00:03<00:01, 298.43 examples/s]Map:  74%|███████▍  | 1016/1368 [00:05<00:09, 38.53 examples/s]Map:  77%|███████▋  | 1048/1368 [00:05<00:06, 52.62 examples/s]Map:  79%|███████▉  | 1080/1368 [00:05<00:04, 70.36 examples/s]Map:  81%|████████▏ | 1112/1368 [00:06<00:02, 91.79 examples/s]Map:  84%|████████▎ | 1144/1368 [00:06<00:01, 116.50 examples/s]Map:  86%|████████▌ | 1176/1368 [00:06<00:01, 143.46 examples/s]Map:  88%|████████▊ | 1208/1368 [00:06<00:00, 171.15 examples/s]Map:  91%|█████████ | 1240/1368 [00:06<00:00, 197.73 examples/s]Map:  93%|█████████▎| 1272/1368 [00:06<00:00, 221.80 examples/s]Map:  95%|█████████▌| 1304/1368 [00:06<00:00, 242.72 examples/s]Map:  98%|█████████▊| 1336/1368 [00:06<00:00, 259.42 examples/s]Map: 100%|██████████| 1368/1368 [00:06<00:00, 272.86 examples/s]                                                                Map:   0%|          | 0/1368 [00:00<?, ? examples/s]Map:   2%|▏         | 31/1368 [00:00<00:04, 298.24 examples/s]Map:   5%|▍         | 63/1368 [00:00<00:04, 301.51 examples/s]Map:   7%|▋         | 95/1368 [00:00<00:04, 302.63 examples/s]Map:   9%|▉         | 127/1368 [00:00<00:04, 303.29 examples/s]Map:  12%|█▏        | 159/1368 [00:00<00:03, 303.22 examples/s]Map:  14%|█▍        | 191/1368 [00:00<00:03, 303.30 examples/s]Map:  16%|█▋        | 223/1368 [00:00<00:03, 303.73 examples/s]Map:  19%|█▊        | 255/1368 [00:00<00:03, 304.13 examples/s]Map:  21%|██        | 287/1368 [00:00<00:03, 303.95 examples/s]Map:  23%|██▎       | 319/1368 [00:01<00:03, 304.17 examples/s]Map:  26%|██▌       | 351/1368 [00:01<00:03, 304.09 examples/s]Map:  28%|██▊       | 383/1368 [00:01<00:03, 303.92 examples/s]Map:  30%|███       | 415/1368 [00:01<00:03, 304.03 examples/s]Map:  33%|███▎      | 447/1368 [00:01<00:03, 304.15 examples/s]Map:  35%|███▌      | 479/1368 [00:01<00:02, 304.10 examples/s]Map:  37%|███▋      | 511/1368 [00:01<00:02, 303.99 examples/s]Map:  40%|███▉      | 543/1368 [00:01<00:02, 304.25 examples/s]Map:  42%|████▏     | 575/1368 [00:01<00:02, 303.90 examples/s]Map:  44%|████▍     | 607/1368 [00:01<00:02, 303.87 examples/s]Map:  47%|████▋     | 639/1368 [00:02<00:02, 303.42 examples/s]Map:  49%|████▉     | 671/1368 [00:02<00:02, 302.95 examples/s]Map:  51%|█████▏    | 703/1368 [00:02<00:02, 302.81 examples/s]Map:  54%|█████▎    | 735/1368 [00:02<00:02, 302.82 examples/s]Map:  56%|█████▌    | 767/1368 [00:02<00:01, 302.79 examples/s]Map:  58%|█████▊    | 799/1368 [00:02<00:01, 302.36 examples/s]Map:  61%|██████    | 831/1368 [00:02<00:01, 302.28 examples/s]Map:  63%|██████▎   | 863/1368 [00:02<00:01, 302.31 examples/s]Map:  65%|██████▌   | 895/1368 [00:02<00:01, 302.28 examples/s]Map:  68%|██████▊   | 927/1368 [00:03<00:01, 302.28 examples/s]Map:  70%|███████   | 959/1368 [00:03<00:01, 302.25 examples/s]Map:  72%|███████▏  | 990/1368 [00:03<00:01, 301.96 examples/s]Map:  75%|███████▌  | 1031/1368 [00:05<00:07, 42.77 examples/s]Map:  78%|███████▊  | 1062/1368 [00:05<00:05, 56.16 examples/s]Map:  80%|███████▉  | 1094/1368 [00:05<00:03, 73.58 examples/s]Map:  82%|████████▏ | 1126/1368 [00:06<00:02, 94.56 examples/s]Map:  85%|████████▍ | 1157/1368 [00:06<00:01, 117.91 examples/s]Map:  87%|████████▋ | 1189/1368 [00:06<00:01, 144.20 examples/s]Map:  89%|████████▉ | 1220/1368 [00:06<00:00, 170.23 examples/s]Map:  92%|█████████▏| 1252/1368 [00:06<00:00, 196.16 examples/s]Map:  94%|█████████▍| 1284/1368 [00:06<00:00, 219.47 examples/s]Map:  96%|█████████▌| 1316/1368 [00:06<00:00, 239.38 examples/s]Map:  99%|█████████▊| 1348/1368 [00:06<00:00, 255.61 examples/s]                                                                Map:   0%|          | 0/1368 [00:00<?, ? examples/s]Map:   2%|▏         | 32/1368 [00:00<00:04, 304.47 examples/s]Map:   5%|▍         | 64/1368 [00:00<00:04, 307.87 examples/s]Map:   7%|▋         | 96/1368 [00:00<00:04, 309.04 examples/s]Map:   9%|▉         | 128/1368 [00:00<00:04, 307.17 examples/s]Map:  12%|█▏        | 160/1368 [00:00<00:03, 306.47 examples/s]Map:  14%|█▍        | 192/1368 [00:00<00:03, 306.30 examples/s]Map:  16%|█▋        | 224/1368 [00:00<00:03, 306.32 examples/s]Map:  19%|█▊        | 256/1368 [00:00<00:03, 306.54 examples/s]Map:  21%|██        | 288/1368 [00:00<00:03, 306.83 examples/s]Map:  23%|██▎       | 320/1368 [00:01<00:03, 306.92 examples/s]Map:  26%|██▌       | 352/1368 [00:01<00:03, 307.10 examples/s]Map:  28%|██▊       | 384/1368 [00:01<00:03, 306.85 examples/s]Map:  30%|███       | 416/1368 [00:01<00:03, 307.06 examples/s]Map:  33%|███▎      | 448/1368 [00:01<00:02, 307.04 examples/s]Map:  35%|███▌      | 480/1368 [00:01<00:02, 307.02 examples/s]Map:  37%|███▋      | 512/1368 [00:01<00:02, 307.08 examples/s]Map:  40%|███▉      | 544/1368 [00:01<00:02, 307.12 examples/s]Map:  42%|████▏     | 576/1368 [00:01<00:02, 307.04 examples/s]Map:  44%|████▍     | 608/1368 [00:01<00:02, 307.11 examples/s]Map:  47%|████▋     | 640/1368 [00:02<00:02, 307.23 examples/s]Map:  49%|████▉     | 672/1368 [00:02<00:02, 307.56 examples/s]Map:  51%|█████▏    | 704/1368 [00:02<00:02, 307.55 examples/s]Map:  54%|█████▍    | 736/1368 [00:02<00:02, 307.45 examples/s]Map:  56%|█████▌    | 768/1368 [00:02<00:01, 306.95 examples/s]Map:  58%|█████▊    | 800/1368 [00:02<00:01, 307.14 examples/s]Map:  61%|██████    | 832/1368 [00:02<00:01, 307.44 examples/s]Map:  63%|██████▎   | 864/1368 [00:02<00:01, 307.47 examples/s]Map:  65%|██████▌   | 896/1368 [00:02<00:01, 307.39 examples/s]Map:  68%|██████▊   | 928/1368 [00:03<00:01, 307.53 examples/s]Map:  70%|███████   | 960/1368 [00:03<00:01, 307.49 examples/s]Map:  73%|███████▎  | 992/1368 [00:03<00:01, 307.40 examples/s]Map:  75%|███████▍  | 1024/1368 [00:03<00:01, 307.24 examples/s]Map:  77%|███████▋  | 1056/1368 [00:03<00:01, 307.12 examples/s]Map:  80%|███████▉  | 1088/1368 [00:03<00:00, 307.28 examples/s]Map:  82%|████████▏ | 1120/1368 [00:03<00:00, 307.17 examples/s]Map:  84%|████████▍ | 1152/1368 [00:03<00:00, 307.29 examples/s]Map:  87%|████████▋ | 1184/1368 [00:03<00:00, 307.35 examples/s]Map:  89%|████████▉ | 1216/1368 [00:03<00:00, 307.35 examples/s]Map:  91%|█████████ | 1248/1368 [00:04<00:00, 307.36 examples/s]Map:  94%|█████████▎| 1280/1368 [00:04<00:00, 307.47 examples/s]Map:  96%|█████████▌| 1312/1368 [00:04<00:00, 307.64 examples/s]Map:  98%|█████████▊| 1344/1368 [00:04<00:00, 307.67 examples/s]                                                                Saving the dataset (0/2 shards):   0%|          | 0/1368 [00:00<?, ? examples/s]Saving the dataset (0/2 shards):  50%|█████     | 684/1368 [00:00<00:00, 2730.46 examples/s]Saving the dataset (1/2 shards):  50%|█████     | 684/1368 [00:00<00:00, 2730.46 examples/s]Saving the dataset (1/2 shards): 100%|██████████| 1368/1368 [00:00<00:00, 1930.37 examples/s]Saving the dataset (2/2 shards): 100%|██████████| 1368/1368 [00:00<00:00, 1930.37 examples/s]                                                                                             Map:   0%|          | 0/456 [00:00<?, ? examples/s]Map:  84%|████████▍ | 385/456 [00:00<00:00, 3762.62 examples/s]                                                               Map (num_proc=8):   0%|          | 0/456 [00:00<?, ? examples/s]Map (num_proc=8):  12%|█▎        | 57/456 [00:02<00:14, 28.01 examples/s]Map (num_proc=8):  25%|██▌       | 114/456 [00:02<00:07, 48.23 examples/s]Map (num_proc=8):  38%|███▊      | 171/456 [00:03<00:04, 67.41 examples/s]Map (num_proc=8):  50%|█████     | 228/456 [00:03<00:02, 76.68 examples/s]Map (num_proc=8):  62%|██████▎   | 285/456 [00:04<00:02, 83.51 examples/s]Map (num_proc=8):  75%|███████▌  | 342/456 [00:04<00:01, 102.02 examples/s]Map (num_proc=8):  88%|████████▊ | 399/456 [00:05<00:00, 99.85 examples/s] Map (num_proc=8): 100%|██████████| 456/456 [00:05<00:00, 106.40 examples/s]                                                                           Map:   0%|          | 0/456 [00:00<?, ? examples/s]Map:   7%|▋         | 32/456 [00:00<00:01, 303.05 examples/s]Map:  14%|█▍        | 64/456 [00:00<00:01, 306.60 examples/s]Map:  21%|██        | 96/456 [00:00<00:01, 308.16 examples/s]Map:  28%|██▊       | 128/456 [00:00<00:01, 308.21 examples/s]Map:  35%|███▌      | 160/456 [00:00<00:00, 308.31 examples/s]Map:  42%|████▏     | 192/456 [00:00<00:00, 308.91 examples/s]Map:  49%|████▉     | 224/456 [00:00<00:00, 310.13 examples/s]Map:  56%|█████▌    | 256/456 [00:00<00:00, 310.73 examples/s]Map:  63%|██████▎   | 288/456 [00:00<00:00, 310.47 examples/s]Map:  70%|███████   | 320/456 [00:01<00:00, 310.81 examples/s]Map:  77%|███████▋  | 352/456 [00:01<00:00, 311.08 examples/s]Map:  84%|████████▍ | 384/456 [00:01<00:00, 310.83 examples/s]Map:  91%|█████████ | 416/456 [00:01<00:00, 311.56 examples/s]Map:  98%|█████████▊| 448/456 [00:01<00:00, 309.09 examples/s]                                                              Map:   0%|          | 0/456 [00:00<?, ? examples/s]Map:   7%|▋         | 32/456 [00:00<00:01, 298.98 examples/s]Map:  14%|█▍        | 64/456 [00:00<00:01, 301.37 examples/s]Map:  21%|██        | 96/456 [00:00<00:01, 302.34 examples/s]Map:  28%|██▊       | 128/456 [00:00<00:01, 302.62 examples/s]Map:  35%|███▌      | 160/456 [00:00<00:00, 303.12 examples/s]Map:  42%|████▏     | 192/456 [00:00<00:00, 303.84 examples/s]Map:  49%|████▉     | 224/456 [00:00<00:00, 304.19 examples/s]Map:  56%|█████▌    | 256/456 [00:00<00:00, 304.89 examples/s]Map:  63%|██████▎   | 288/456 [00:00<00:00, 305.37 examples/s]Map:  70%|███████   | 320/456 [00:01<00:00, 305.49 examples/s]Map:  77%|███████▋  | 352/456 [00:01<00:00, 305.25 examples/s]Map:  84%|████████▍ | 384/456 [00:01<00:00, 305.25 examples/s]Map:  91%|█████████ | 416/456 [00:01<00:00, 305.00 examples/s]Map:  98%|█████████▊| 448/456 [00:01<00:00, 305.37 examples/s]                                                              Map:   0%|          | 0/456 [00:00<?, ? examples/s]Map:   7%|▋         | 32/456 [00:00<00:01, 309.10 examples/s]Map:  14%|█▍        | 64/456 [00:00<00:01, 311.83 examples/s]Map:  21%|██        | 96/456 [00:00<00:01, 312.74 examples/s]Map:  28%|██▊       | 128/456 [00:00<00:01, 313.27 examples/s]Map:  35%|███▌      | 160/456 [00:00<00:00, 313.48 examples/s]Map:  42%|████▏     | 192/456 [00:00<00:00, 313.36 examples/s]Map:  49%|████▉     | 224/456 [00:00<00:00, 312.87 examples/s]Map:  56%|█████▌    | 256/456 [00:00<00:00, 312.08 examples/s]Map:  63%|██████▎   | 288/456 [00:00<00:00, 311.67 examples/s]Map:  70%|███████   | 320/456 [00:01<00:00, 311.04 examples/s]Map:  77%|███████▋  | 352/456 [00:01<00:00, 310.95 examples/s]Map:  84%|████████▍ | 384/456 [00:01<00:00, 311.34 examples/s]Map:  91%|█████████ | 416/456 [00:01<00:00, 311.75 examples/s]Map:  98%|█████████▊| 448/456 [00:01<00:00, 311.80 examples/s]                                                              Saving the dataset (0/1 shards):   0%|          | 0/456 [00:00<?, ? examples/s]Saving the dataset (0/1 shards): 100%|██████████| 456/456 [00:00<00:00, 2688.72 examples/s]Saving the dataset (1/1 shards): 100%|██████████| 456/456 [00:00<00:00, 2688.72 examples/s]                                                                                           Map:   0%|          | 0/457 [00:00<?, ? examples/s]Map:  83%|████████▎ | 380/457 [00:00<00:00, 3752.16 examples/s]                                                               Map (num_proc=8):   0%|          | 0/457 [00:00<?, ? examples/s]Map (num_proc=8):  13%|█▎        | 58/457 [00:02<00:15, 25.91 examples/s]Map (num_proc=8):  25%|██▌       | 115/457 [00:02<00:07, 47.08 examples/s]Map (num_proc=8):  38%|███▊      | 172/457 [00:03<00:04, 61.51 examples/s]Map (num_proc=8):  50%|█████     | 229/457 [00:03<00:03, 73.99 examples/s]Map (num_proc=8):  63%|██████▎   | 286/457 [00:04<00:01, 89.32 examples/s]Map (num_proc=8):  75%|███████▌  | 343/457 [00:04<00:01, 89.36 examples/s]Map (num_proc=8):  88%|████████▊ | 400/457 [00:05<00:00, 90.90 examples/s]Map (num_proc=8): 100%|██████████| 457/457 [00:05<00:00, 104.70 examples/s]                                                                           Map:   0%|          | 0/457 [00:00<?, ? examples/s]Map:   7%|▋         | 32/457 [00:00<00:01, 302.39 examples/s]Map:  14%|█▍        | 64/457 [00:00<00:01, 305.89 examples/s]Map:  21%|██        | 96/457 [00:00<00:01, 307.52 examples/s]Map:  28%|██▊       | 128/457 [00:00<00:01, 307.28 examples/s]Map:  35%|███▌      | 160/457 [00:00<00:00, 308.33 examples/s]Map:  42%|████▏     | 192/457 [00:00<00:00, 309.14 examples/s]Map:  49%|████▉     | 224/457 [00:00<00:00, 309.68 examples/s]Map:  56%|█████▌    | 256/457 [00:00<00:00, 310.06 examples/s]Map:  63%|██████▎   | 288/457 [00:00<00:00, 310.25 examples/s]Map:  70%|███████   | 320/457 [00:01<00:00, 310.60 examples/s]Map:  77%|███████▋  | 352/457 [00:01<00:00, 310.61 examples/s]Map:  84%|████████▍ | 384/457 [00:01<00:00, 310.59 examples/s]Map:  91%|█████████ | 416/457 [00:01<00:00, 310.53 examples/s]Map:  98%|█████████▊| 448/457 [00:01<00:00, 310.81 examples/s]                                                              Map:   0%|          | 0/457 [00:00<?, ? examples/s]Map:   7%|▋         | 31/457 [00:00<00:01, 297.80 examples/s]Map:  14%|█▍        | 63/457 [00:00<00:01, 301.83 examples/s]Map:  21%|██        | 95/457 [00:00<00:01, 303.48 examples/s]Map:  28%|██▊       | 127/457 [00:00<00:01, 303.56 examples/s]Map:  35%|███▍      | 159/457 [00:00<00:00, 303.95 examples/s]Map:  42%|████▏     | 191/457 [00:00<00:00, 304.24 examples/s]Map:  49%|████▉     | 223/457 [00:00<00:00, 304.57 examples/s]Map:  56%|█████▌    | 255/457 [00:00<00:00, 304.64 examples/s]Map:  63%|██████▎   | 287/457 [00:00<00:00, 304.74 examples/s]Map:  70%|██████▉   | 319/457 [00:01<00:00, 304.80 examples/s]Map:  77%|███████▋  | 351/457 [00:01<00:00, 304.48 examples/s]Map:  84%|████████▍ | 383/457 [00:01<00:00, 304.54 examples/s]Map:  91%|█████████ | 415/457 [00:01<00:00, 304.64 examples/s]Map:  98%|█████████▊| 447/457 [00:01<00:00, 304.67 examples/s]                                                              Map:   0%|          | 0/457 [00:00<?, ? examples/s]Map:   7%|▋         | 32/457 [00:00<00:01, 306.29 examples/s]Map:  14%|█▍        | 64/457 [00:00<00:01, 307.49 examples/s]Map:  21%|██        | 96/457 [00:00<00:01, 306.24 examples/s]Map:  28%|██▊       | 128/457 [00:00<00:01, 306.37 examples/s]Map:  35%|███▌      | 160/457 [00:00<00:00, 306.45 examples/s]Map:  42%|████▏     | 192/457 [00:00<00:00, 305.54 examples/s]Map:  49%|████▉     | 224/457 [00:00<00:00, 306.65 examples/s]Map:  56%|█████▌    | 256/457 [00:00<00:00, 307.21 examples/s]Map:  63%|██████▎   | 288/457 [00:00<00:00, 308.05 examples/s]Map:  70%|███████   | 320/457 [00:01<00:00, 308.93 examples/s]Map:  77%|███████▋  | 352/457 [00:01<00:00, 309.53 examples/s]Map:  84%|████████▍ | 384/457 [00:01<00:00, 309.15 examples/s]Map:  91%|█████████ | 416/457 [00:01<00:00, 308.25 examples/s]Map:  98%|█████████▊| 448/457 [00:01<00:00, 308.75 examples/s]                                                              Saving the dataset (0/1 shards):   0%|          | 0/457 [00:00<?, ? examples/s]Saving the dataset (0/1 shards): 100%|██████████| 457/457 [00:00<00:00, 1267.80 examples/s]Saving the dataset (1/1 shards): 100%|██████████| 457/457 [00:00<00:00, 1267.80 examples/s]                                                                                           /leonardo/home/userexternal/afilippa/miniconda3/envs/deepmlf-cu12/lib/python3.10/site-packages/torch/nn/modules/transformer.py:282: UserWarning: enable_nested_tensor is True, but self.use_nested_tensor is False because encoder_layer.norm_first was True
  warnings.warn(f"enable_nested_tensor is True, but self.use_nested_tensor is False because {why_not_sparsity_fast_path}")
MMSA - The model has 161110858 trainable parameters
  0%|          | 0/43 [00:00<?, ?it/s]  0%|          | 0/43 [00:01<?, ?it/s]
Traceback (most recent call last):
  File "/leonardo_work/EUHPC_A04_051/alexfil/MoEMMSA/experiments/regression/mult_base.py", line 32, in <module>
    MMSA_run(
  File "/leonardo_work/EUHPC_A04_051/alexfil/MoEMMSA/experiments/regression/../../MMSA/run.py", line 390, in MMSA_run
    result = _run(args, num_workers, is_tune)
  File "/leonardo_work/EUHPC_A04_051/alexfil/MoEMMSA/experiments/regression/../../MMSA/run.py", line 445, in _run
    epoch_results = trainer.do_train(model, dataloader, return_epoch_results=from_sena)
  File "/leonardo_work/EUHPC_A04_051/alexfil/MoEMMSA/experiments/regression/../../MMSA/trains/singleTask/MSALM.py", line 425, in do_train
    outputs = model(text_ids, audio, vision, attention_mask=attention_mask)
  File "/leonardo/home/userexternal/afilippa/miniconda3/envs/deepmlf-cu12/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/leonardo/home/userexternal/afilippa/miniconda3/envs/deepmlf-cu12/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl
    return forward_call(*args, **kwargs)
  File "/leonardo_work/EUHPC_A04_051/alexfil/MoEMMSA/experiments/regression/../../MMSA/models/AMIO.py", line 45, in forward
    return self.Model(text_x, audio_x, video_x, *args, **kwargs)
  File "/leonardo/home/userexternal/afilippa/miniconda3/envs/deepmlf-cu12/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/leonardo/home/userexternal/afilippa/miniconda3/envs/deepmlf-cu12/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl
    return forward_call(*args, **kwargs)
  File "/leonardo_work/EUHPC_A04_051/alexfil/MoEMMSA/experiments/regression/../../MMSA/models/singleTask/MSALM.py", line 1043, in forward
    outputs = self.lang_encoder(
  File "/leonardo/home/userexternal/afilippa/miniconda3/envs/deepmlf-cu12/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/leonardo/home/userexternal/afilippa/miniconda3/envs/deepmlf-cu12/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl
    return forward_call(*args, **kwargs)
  File "/leonardo_work/EUHPC_A04_051/alexfil/MoEMMSA/experiments/regression/../../MMSA/models/singleTask/MSALM.py", line 850, in forward
    return super().forward(**kwargs)  # Call the other parent's forward method
  File "/leonardo/home/userexternal/afilippa/miniconda3/envs/deepmlf-cu12/lib/python3.10/site-packages/transformers/models/gpt2/modeling_gpt2.py", line 1043, in forward
    transformer_outputs = self.transformer(
  File "/leonardo/home/userexternal/afilippa/miniconda3/envs/deepmlf-cu12/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/leonardo/home/userexternal/afilippa/miniconda3/envs/deepmlf-cu12/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl
    return forward_call(*args, **kwargs)
  File "/leonardo/home/userexternal/afilippa/miniconda3/envs/deepmlf-cu12/lib/python3.10/site-packages/transformers/models/gpt2/modeling_gpt2.py", line 887, in forward
    outputs = block(
  File "/leonardo/home/userexternal/afilippa/miniconda3/envs/deepmlf-cu12/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/leonardo/home/userexternal/afilippa/miniconda3/envs/deepmlf-cu12/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl
    return forward_call(*args, **kwargs)
  File "/leonardo_work/EUHPC_A04_051/alexfil/MoEMMSA/experiments/regression/../../MMSA/models/singleTask/MSALM.py", line 485, in forward
    updated_lang_x = self.ca_layer(
  File "/leonardo/home/userexternal/afilippa/miniconda3/envs/deepmlf-cu12/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/leonardo/home/userexternal/afilippa/miniconda3/envs/deepmlf-cu12/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl
    return forward_call(*args, **kwargs)
  File "/leonardo_work/EUHPC_A04_051/alexfil/MoEMMSA/experiments/regression/../../MMSA/models/singleTask/MSALM.py", line 1628, in forward
    out = expert(q_tokens, ctx)  # [N, 1, D]
  File "/leonardo/home/userexternal/afilippa/miniconda3/envs/deepmlf-cu12/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/leonardo/home/userexternal/afilippa/miniconda3/envs/deepmlf-cu12/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl
    return forward_call(*args, **kwargs)
  File "/leonardo_work/EUHPC_A04_051/alexfil/MoEMMSA/experiments/regression/../../MMSA/models/singleTask/MSALM.py", line 1218, in forward
    x_expert = self.attn(norm_x_f, z_context)
  File "/leonardo/home/userexternal/afilippa/miniconda3/envs/deepmlf-cu12/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/leonardo/home/userexternal/afilippa/miniconda3/envs/deepmlf-cu12/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl
    return forward_call(*args, **kwargs)
  File "/leonardo_work/EUHPC_A04_051/alexfil/MoEMMSA/experiments/regression/../../MMSA/models/singleTask/MMGPT.py", line 187, in forward
    attn_output = self.scaled_dot_product_attention(x_q, x_k, x_v, mask)
  File "/leonardo_work/EUHPC_A04_051/alexfil/MoEMMSA/experiments/regression/../../MMSA/models/singleTask/MMGPT.py", line 164, in scaled_dot_product_attention
    torch.matmul(q, k.transpose(-2, -1)) / math.sqrt(self.d_model)
RuntimeError: The size of tensor a (433) must match the size of tensor b (32) at non-singleton dimension 0
